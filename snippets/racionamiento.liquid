<section id="tablesDogs" class="mb-5">
  <div class="row d-flex">
    <!-- /.col img -->
    <div class="col">
      <!-- /Intro text -->
      <div id="tableCalc" class="mb-3">
        <div id="age-size-food" class="d-flex age-size-food my-3">
          <div class="box-option-racionamiento">
            <label for="numer_eta">
              <p class="text-over-racionamiento">Indica su edad:</p>
            </label>
            <select class="value-racionamiento" name="numer_eta" id="numer_eta"></select>
          </div>
          <div class="box-option-racionamiento">
            <label for="numer_pesi">
              <p class="text-over-racionamiento">Indica su peso:</p>
            </label>
            <select class="value-racionamiento" name="numer_pesi" id="numer_pesi"></select>
          </div>
          <div class="box-option-racionamiento">
            <label for="numer_pasti">
              <p class="text-over-racionamiento">N° comidas diarias:</p>
            </label>
            <select class="value-racionamiento" name="numer_pasti" id="numer_pasti"></select>
          </div>
        </div>

        <!-- Get first values: age, size and food -->
        <div id="objetivo-actividades-box">
          <div id="objetivo-actividades" class="objetivo-actividades-group"></div>
        </div>
        <div class="obiettivo-block d-flex flex-column rounded my-3">
          <div id="title-objetivo" class=" p-3 ps-0 obiettivo-box fw-bold border-top-4 mb-1">¿Cuál es tu objetivo?</div>
          <div id="objetivo" class="btn-group" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="objetivo" value="mantenimiento" id="mantenimiento">
            <label class="btn box-option-racionamiento" for="mantenimiento">Mantenimiento</label>

            <input type="radio" class="btn-check" name="objetivo" value="light" id="light">
            <label id="objettivo-light" class="btn box-option-racionamiento" for="light">Dieta Light</label>

            <input type="radio" class="btn-check" name="objetivo" value="perdida_de_peso" id="perdida_de_peso">
            <label id="objettivo-perdida-peso" class="btn box-option-racionamiento" for="perdida_de_peso">
              {{- 'products.product.perdida_de_peso' | t -}}
            </label>
          </div>
        </div>
        <!-- /first-tables (objetivo) -->

        <div id="activitades" class="d-none shadow-none rounded mb-3 obiettivo-block">
          <div id="title-actividades" class=" p-3 ps-0 obiettivo-box fw-bold border-top-4 mb-1 w-100">
            ¿Cuál es el nivel de actividad de tu mascota?
          </div>
          <div
            id="objetivo-actividad"
            class="btn-group w-100"
            role="group"
            aria-label="Basic radio toggle button group"
          >
            <input
              type="radio"
              class="btn-check"
              name="actividad"
              value="actividad_normal"
              id="actividad_normal"
            >
            <label class="btn box-option-racionamiento actividad-values" for="actividad_normal">
              {{- 'products.product.actividadnormal' | t -}}
            </label>

            <input type="radio" class="btn-check" name="actividad" value="actividad_moderate" id="actividad_moderate">
            <label class="btn box-option-racionamiento actividad-values" for="actividad_moderate">
              {{- 'products.product.actividad_moderata' | t -}}
            </label>

            <input type="radio" class="btn-check" name="actividad" value="actividad_high" id="actividad_high">
            <label class="btn box-option-racionamiento actividad-values" for="actividad_high">
              {{- 'products.product.actividad_alta' | t -}}
            </label>

            <input type="radio" class="btn-check" name="actividad" value="extreme_activity" id="extreme_activity">
            <label class="btn box-option-racionamiento actividad-values" for="extreme_activity">
              {{- 'products.product.actividad_extrema' | t -}}
            </label>
          </div>
        </div>
        <!-- /second-tables (ACTIVIDAD) -->

        <button
          id="calculator"
          class="btn shadow-none d-flex justify-content-center obiettivo-box border-0 rounded-5 py-4 px-5 my-3"
        >
          Calcular racionamiento
        </button>
        <!-- BTN - calcolator -->
      </div>
      <!-- /Table -->
      <div id="tableResult" class="d-none shadow-none">
        <h4 class="text-center p-3 obiettivo-box fw-bold border-top-4 mb-2 ps-0 fs-2">Racionamiento Diario</h4>
        <row class="row-result d-flex w-100" style="max-width:700px">
          <div id="cantidaddiaria" class="box-option-racionamiento resultados text-center py-4">
            <div id="calcolo" class="value-racionamiento text-center fs-1"></div>
            <div id="testo-razionamento" class="text-over-racionamiento"></div>
          </div>
          <div id="gPasto" class="box-option-racionamiento text-center py-4 resultados">
            <div id="grammi" class="value-racionamiento text-center fs-1"></div>
            <div id="testo-grammi" class="text-over-racionamiento"></div>
          </div>
        </row>
        <div id="resumen" class="mt-2 py-4">
          <div class="fs-6"><span id="obiettivo-testo">Objetivo </span><span id="obiettivo" class="fs-6"></span></div>
          <div id="attivita" class="text-over-racionamiento"></div>
        </div>

        <button
          id="changes"
          class="btn d-flex justify-content-center shadow-none obiettivo-box border-0 rounded-5 py-4 px-5 my-3"
        >
          Cambiar parametros
        </button>
        <!-- BTN - changes values -->
      </div>
    </div>
    <!-- /.col tables -->
  </div>
  <div id="table_product"></div>
</section>

<!-- /#tablesDogs -->

<script>
// Bulding tables

// TABLES PRODUCTS
// 1. Age:
let numeri_eta = [];

for (let i = 1; i <= 20; i++) {
  numero = i; // - numeri da 1 a 200.
  numeri_eta.push(numero); // - Inserisco nell'array i numeri.
}

let age = document.getElementById("numer_eta");

numeri_eta.forEach((numero) => {
  const memberMarkup = ` 
    <option value="${numero}">${numero}</option>
    `;
  age.insertAdjacentHTML("beforeend", memberMarkup);
});

// 2. Size:
let numeri_pesi = [];

for (let i = 1; i <= 100; i++) {
  const numero = i; // - numeri da 1 a 100.
  numeri_pesi.push(numero); // - Inserisco nell'array i numeri.
}

let size = document.getElementById("numer_pesi");

numeri_pesi.forEach((numero) => {
  const memberMarkup = ` 
    <option value="${numero}">${numero}</option>
    `;
  size.insertAdjacentHTML("beforeend", memberMarkup);
});

// 3. Food:
let numeri_pasti = [];

for (let i = 1; i <= 4; i++) {
  numero = i; // - numeri da 1 a 100.
  numeri_pasti.push(numero); // - Inserisco nell'array i numeri.
}

let food = document.getElementById("numer_pasti");

numeri_pasti.forEach((numero) => {
  const memberMarkup = ` 
    <option value="${numero}">${numero}</option>
    `;
  food.insertAdjacentHTML("beforeend", memberMarkup);
});

// Take value
//let age = divElement_eta.value; // - document.getElementById("numer_eta").value;
//let size = divElement_pesi.value; // - document.getElementById("numer_pesi").value;
//let food = divElement_pasti.value; // - document.getElementById("numer_pasti").value;
//console.log(food.value);

// Conditional => table to view other table.

// Nascondi inizialmente la parte age-size-food
document.getElementById("age-size-food").classList.add("d-none");
  
// Gestione delle selezioni della prima domanda (Obiettivo)
document.querySelectorAll('input[name="objetivo"]').forEach(option => {
  option.addEventListener("change", function () {
    // Nascondi solo i label della prima domanda
    document.querySelectorAll('#objetivo label').forEach(label => label.classList.add('d-none'));

    // Mostra solo il label dell'opzione selezionata
    const selectedLabel = document.querySelector(`label[for="${this.id}"]`);
    if (selectedLabel) selectedLabel.classList.remove('d-none');

    // Mostra il valore scelto nella riga sotto
    const obiettivoRow = document.getElementById("obiettivo-riga");
    const selectedLabeel = document.querySelector(`label[for="${this.id}"]`);
    if (!obiettivoRow) {
      const newObiettivoRow = document.createElement("div");
      newObiettivoRow.id = "obiettivo-riga";
      newObiettivoRow.innerHTML = `
        <p class="objetivo-selected">Objetivo: <span id="obiettivo-valore" class="cliccabile valore-objetivo">${selectedLabeel.textContent}</span></p>
      `;
      document.querySelector("#objetivo-actividades").appendChild(newObiettivoRow);

      // Rendi cliccabile per tornare indietro
      document.getElementById("obiettivo-riga").addEventListener("click", function () {
        resetSelection("objetivo");
      });
    } else {
      document.getElementById("obiettivo-valore").textContent = this.value;
    }

    // Mostra o nascondi la sezione "activitades"
    const activitadesSection = document.getElementById("activitades");
    if (this.value === "mantenimiento") {
      document.getElementById("title-objetivo").classList.add("d-none")
      document.getElementById("objetivo").classList.add("d-none")
      
      activitadesSection.classList.remove("d-none");
     const elements = document.getElementsByClassName("actividad-values");
        for (let element of elements) {
          element.classList.remove("d-none");
        }
    } else {
      activitadesSection.classList.add("d-none");
      document.getElementById("title-objetivo").classList.add("d-none")
      document.getElementById("objetivo").classList.add("d-none")
      document.getElementById("age-size-food").classList.remove("d-none");
    }
  });
});

// Gestione delle selezioni della seconda domanda (Attività, solo per "mantenimiento")
document.querySelectorAll('input[name="actividad"]').forEach(option => {
  option.addEventListener("change", function () {
    // Nascondi tutti i label e input non selezionati
    document.getElementById("age-size-food").classList.remove("d-none");
    document.getElementById("title-actividades").classList.add("d-none");
    document.getElementById("activitades").classList.add("d-none");
    document.querySelectorAll('input[name="actividad"]').forEach(input => {
      const label = document.querySelector(`label[for="${input.id}"]`);
      if (input !== this) {
        input.classList.add('d-none'); // Nascondi input
        if (label) label.classList.add('d-none'); // Nascondi label corrispondente
      }
    });

    // Mostra la riga con l'attività selezionata
    const actividadRow = document.getElementById("actividad-riga");
    const selectedLabel = document.querySelector(`label[for="${this.id}"]`);

    if (!actividadRow) {
      const newActividadRow = document.createElement("div");
      newActividadRow.id = "actividad-riga";
      newActividadRow.innerHTML = `
  <p class="objetivo-selected">Actividad: <span id="actividad-valore" class="cliccabile valore-objetivo">${selectedLabel.textContent}</span></p>`;
      document.querySelector("#objetivo-actividades").appendChild(newActividadRow);

      // Rendi cliccabile per tornare indietro
      document.getElementById("actividad-riga").addEventListener("click", function () {
        resetSelection("actividad");
      });
    } else {
      document.getElementById("actividad-valore").textContent = this.value;
    }
  });
});


// Funzione per resettare una selezione
function resetSelection(name) {
  // Ripristina la selezione dei radio button
  document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
    input.checked = false;
    const label = document.querySelector(`label[for="${input.id}"]`);
    if (label) label.classList.remove('d-none');
  });

  if (name === "objetivo") {
    // Rimuovi la riga degli obiettivi e nascondi la sezione "activitades"
    document.getElementById("obiettivo-riga")?.remove();
    document.getElementById("activitades").classList.add("d-none");
    document.getElementById("objetivo").classList.remove("d-none");
    document.getElementById("actividad-riga")?.remove();
    document.getElementById("age-size-food").classList.add("d-none");
  } else if (name === "actividad") {
    // Rimuovi la riga dell'attività
    document.getElementById("actividad-riga")?.remove();
    document.getElementById("age-size-food").classList.add("d-none");
    document.getElementById("objetivo-actividad").classList.remove("d-none");  
  }
}



// TABLES OBJECT

// BTN - CALCULATION

const btn_calculator = document.getElementById("calculator");

btn_calculator.addEventListener("click", getValue);
  
function getValue() {
  // Nascondi tableCalc, mostra tableResult
  document.getElementById("tableCalc").classList.add("d-none");
  document.getElementById("tableCalc").classList.remove("shadow");
  document.getElementById("tableResult").classList.add("d-display");
  document.getElementById("tableResult").classList.remove("d-none");

  // Leggi "objetivo" selezionato
  let objetivo = document.querySelector('input[name="objetivo"]:checked')?.value;
  if (!objetivo) {
    alert("Por favor, selecciona un objetivo antes de continuar.");
    return;
  }

  // Leggi "actividad" solo se objetivo = "mantenimiento"
  let actividad = null;
  if (objetivo === "mantenimiento") {
    let actividadChecked = document.querySelector('input[name="actividad"]:checked');
    if (!actividadChecked) {
      alert("Por favor, selecciona un nivel de actividad para tu mascota.");
      return;
    }
    actividad = actividadChecked.value;
  }

  // Leggi valori età, peso, pasti
  let ageValue = parseInt(document.getElementById("numer_eta").value);
  let sizeValue = parseInt(document.getElementById("numer_pesi").value);
  let foodValue = parseInt(document.getElementById("numer_pasti").value);

  // Qui leggi le kcal dal tuo metafield
  var kcal = {{ product.metafields.custom.kcal }};

  let vrP = 110; // valore di default

  // Calcolo di vrP in base al "objetivo" e (se mantenimiento) "actividad"
  if (ageValue < 3 && objetivo === "mantenimiento" && actividad === "actividad_normal") {
    vrP = 130;
  } else if (ageValue < 3 && objetivo === "mantenimiento" && actividad === "actividad_moderate") {
    vrP = 130;
  } else if (ageValue < 3 && objetivo === "mantenimiento" && actividad === "actividad_high") {
    vrP = 167.5;
  } else if (ageValue < 3 && objetivo === "mantenimiento" && actividad === "extreme_activity") {
    vrP = 1050;
  } else if (ageValue >= 3 && ageValue < 7 && objetivo === "mantenimiento" && actividad === "actividad_normal") {
    vrP = 110;
  } else if (ageValue >= 3 && ageValue < 7 && objetivo === "mantenimiento" && actividad === "actividad_moderate") {
    vrP = 125;
  } else if (ageValue >= 3 && ageValue < 7 && objetivo === "mantenimiento" && actividad === "actividad_high") {
    vrP = 167.5;
  } else if (ageValue >= 3 && ageValue < 7 && objetivo === "mantenimiento" && actividad === "extreme_activity") {
    vrP = 1050;
  } else if (ageValue > 7 && objetivo === "mantenimiento" && actividad === "actividad_normal") {
    vrP = 95;
  } else if (ageValue > 7 && objetivo === "mantenimiento" && actividad === "actividad_moderate") {
    vrP = 125;
  } else if (ageValue > 7 && objetivo === "mantenimiento" && actividad === "actividad_high") {
    vrP = 167.5;
  } else if (ageValue > 7 && objetivo === "mantenimiento" && actividad === "extreme_activity") {
    vrP = 1050;
  } else if (objetivo === "perdida_de_peso") {
    vrP = 66;
  } else if (objetivo === "light") {
    vrP = 95;
  }

  // Calcolo della razione
  let calcolateDiaria = Math.round((vrP * Math.pow(sizeValue, 0.75)) / kcal * 1000);
  let dividedPasti = parseInt(calcolateDiaria / foodValue);

  // Output a schermo
  document.getElementById("calcolo").innerHTML = `${calcolateDiaria}`;
  document.getElementById("testo-razionamento").innerHTML = `{{ 'products.product.cantidad_diaria_recomendada' | t }}`;
  document.getElementById("grammi").innerHTML = `${dividedPasti} gr`;
  document.getElementById("testo-grammi").innerHTML = `{{ 'products.product.por_cada_racion' | t }}`;

  // Info riquadro final
  if (objetivo === "mantenimiento") {
    // attività
    if (actividad === "actividad_normal") {
      document.getElementById("obiettivo").innerHTML = `dieta mantenimiento con actividad {{ 'products.product.actividadnormal' | t }}`;
    } else if (actividad === "actividad_moderate") {
      document.getElementById("obiettivo").innerHTML = `dieta mantenimiento con actividad {{ 'products.product.actividad_moderata' | t }}`;
    } else if (actividad === "actividad_high") {
      document.getElementById("obiettivo").innerHTML = `dieta mantenimiento con actividad {{ 'products.product.actividad_alta' | t }}`;
    } else if (actividad === "extreme_activity") {
      document.getElementById("obiettivo").innerHTML = `dieta mantenimiento con actividad {{ 'products.product.actividad_extrema' | t }}`;
    }
  } else if (objetivo === "light") {
    document.getElementById("obiettivo").innerHTML = `dieta light`;
  } else if (objetivo === "perdida_de_peso") {
    document.getElementById("obiettivo").innerHTML = `dieta {{ 'products.product.perdida_de_peso' | t }}`;
  }
}

// BTN - CHANGES
const btn_changes = document.getElementById("changes");
btn_changes.addEventListener("click", getChanges);

function getChanges() {
  document.getElementById("tableCalc").classList.remove("d-none");
  document.getElementById("tableResult").classList.add("d-none");
}
</script>
